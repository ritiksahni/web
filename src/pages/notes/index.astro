---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const notesRaw = await getCollection('notes');
const notes = await Promise.all(
    notesRaw
        .sort((a, b) => +b.data.publishDate - +a.data.publishDate)
        .map(async (entry) => {
            const { Content } = await entry.render();
            return { entry, Content };
        })
);
---

<BaseLayout title="Notes" description="A linear stream of short notes." showHeader={false} wide>
    <section class="full-bleed blue-hero py-8 sm:py-12 mb-12 sm:mb-16">
        <div class="w-full max-w-6xl mx-auto px-4 md:px-8">
            <h1 class="text-5xl sm:text-6xl leading-tight font-serif font-medium tracking-tight">Notes</h1>
            <p class="mt-2 text-lg sm:text-xl max-w-3xl">Short, unfiltered thoughts. Fast-moving. Sometimes with images from my iPhone.</p>
        </div>
    </section>

    <ol class="relative border-s border-dashed border-accent pl-8 space-y-10">
        {
            notes.map(({ entry, Content }) => (
                <li>
                    <div class="flex items-start gap-3">
                        <span class="mt-1 inline-block w-2.5 h-2.5 rounded-full bg-accent shrink-0" />
                        <div class="min-w-0">
                            <time class="block text-xs uppercase tracking-wide text-accent">
                                {new Date(entry.data.publishDate).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: '2-digit' })}
                            </time>
                            <h3 class="mt-1 text-xl font-serif font-medium">{entry.data.title}</h3>
                            <div class="mt-3 max-w-2xl prose prose-dante">{Content && <Content />}</div>
                        </div>
                    </div>
                </li>
            ))
        }
    </ol>
</BaseLayout>
