---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import siteConfig from '../data/site-config';
import { sortItemsByDateDesc } from '../utils/data-utils';

const posts = (await getCollection('blog')).sort(sortItemsByDateDesc).slice(0, 4);
const pages = await getCollection('pages');
const notesPage = pages.find((p) => p.slug === 'notes');
let latestNoteTitle = '';
if (notesPage) {
    const headingRegex = /^##\s*(\d{4}-\d{2}-\d{2})\s*\|\s*(.+)$/gm;
    let match;
    let latestTs = 0;
    while ((match = headingRegex.exec(notesPage.body)) !== null) {
        const ts = Date.parse(match[1]);
        if (!Number.isNaN(ts) && ts > latestTs) {
            latestTs = ts;
            latestNoteTitle = (match[2] || '').trim();
        }
    }
}
---

<BaseLayout description={siteConfig.description} image={siteConfig.image} wide showHeader={false}>
    <section class="full-bleed blue-hero py-16 sm:py-24 mb-16 sm:mb-24">
        <div class="w-full max-w-6xl mx-auto px-4 md:px-8 relative">
            <div class="relative z-10">
                <h1 class="text-7xl sm:text-9xl leading-[1.02] font-serif font-medium tracking-tight">Ritik Sahni</h1>
                <p class="mt-4 text-2xl sm:text-3xl max-w-5xl">Backend systems, tech & culture.</p>
            </div>
        </div>
    </section>

    <section class="grid grid-cols-1 gap-10 sm:grid-cols-12 sm:gap-12 mb-16 sm:mb-24">
        <div class="sm:col-span-6">
            <h2 class="text-4xl sm:text-5xl font-serif font-medium mb-6 text-accent">Writings</h2>
            <ul class="space-y-4">
                {
                    posts.map((p) => (
                        <li>
                            <a class="block group" href={`/blog/${p.slug}`}>
                                <span class="inline-block underline decoration-1 underline-offset-2 group-hover:decoration-2">{p.data.title}</span>
                            </a>
                        </li>
                    ))
                }
            </ul>
            <div class="mt-6">
                <a class="text-accent hover:underline text-lg" href="/blog">All writing →</a>
            </div>
        </div>
        <div class="sm:col-span-6">
            <h2 class="text-4xl sm:text-5xl font-serif font-medium mb-6 text-accent">Notes</h2>
            {
                latestNoteTitle && (
                    <a class="block hover:underline text-lg" href="/notes">
                        {latestNoteTitle}
                    </a>
                )
            }
            <div class="mt-6">
                <a class="text-accent hover:underline text-lg" href="/notes">Browse notes →</a>
            </div>
        </div>
    </section>

    <section class="grid grid-cols-1 gap-10 sm:grid-cols-2 mb-16 sm:mb-24">
        <div class="border-l-4 border-accent pl-6">
            <h2 class="text-2xl sm:text-3xl font-serif font-medium mb-4 text-accent">Projects</h2>
            <p class="mb-4">Utilities, infra tools, and experiments that leave a dent.</p>
            <a class="text-accent hover:underline" href="/projects">View projects →</a>
        </div>
        <div class="border-l-4 border-main pl-6">
            <h2 class="text-2xl sm:text-3xl font-serif font-medium mb-4 text-accent">About</h2>
            <p class="mb-4">Engineer. Writer. Builder.</p>
            <a class="text-accent hover:underline" href="/about">More about me →</a>
        </div>
    </section>
</BaseLayout>
